<!doctype html>
<html>
<head>

<meta charset="utf-8">
<script src="../../webcomponentsjs/webcomponents.js"></script>
<script src="../../web-component-tester/browser.js"></script>
<link rel="import" href="../../polymer/polymer.html">
<script src="../BasicContentChanged.js"></script>

<polymer-element name="test-element">
<script>
Polymer(Polymer.mixin({

  attached: function() {
    this.observeContentChanges();
  },

  contentChanged: function() {
    if (this.contentChangedHook) {
      this.contentChangedHook();
    }
  },

  detached: function() {
    this.observeContentChanges(false);
    if (this.detachedHook) {
      this.detatchedHook();
    }
  }

}, BasicContentChanged));
</script>
</polymer-element>

<polymer-element name="redistribute-element" noscript>
<template>
  <test-element id="nestedTestElement"><content></content></test-element>
</template>
</polymer-element>

</head>

<body>

<div id="container"></div>

<script>
suite('<test-element>', function() {

  this.timeout(2000);

  var container = document.getElementById('container');

  teardown(function() {
    container.innerHTML = '';
  });

  test('observe changes in textContent', function(done) {
    var fixture = document.createElement('test-element');
    fixture.contentChangedHook = function() {
      assert.equal(fixture.textContent, 'Hello');
      done();
    };
    container.appendChild(fixture);
    fixture.textContent = 'Hello';
  });

  test('specifying initial content triggers initial contentChanged', function(done) {
    var fixture = document.createElement('test-element');
    fixture.textContent = 'Hello';
    fixture.contentChangedHook = function() {
      assert.equal(fixture.textContent, 'Hello');
      done();
    };
    container.appendChild(fixture);
  });

  test('detaching an element stops it observing future content changes', function(done) {
    var fixture = document.createElement('test-element');
    fixture.contentChangedHook = function() {
      assert.equal(fixture.textContent, 'Hello');
      fixture.remove();
      done();
    };
    fixture.detatchedHook = function() {
      fixture.textContent = 'Goodbye';
    };
    container.appendChild(fixture);
    fixture.textContent = 'Hello';
  });

  test('redistributed content triggers contentChanged', function(done) {
    var fixture = document.createElement('redistribute-element');
    var nestedTestElement = fixture.$.nestedTestElement;
    container.appendChild(fixture);
    nestedTestElement.contentChangedHook = function() {
      assert.equal(fixture.textContent, 'Hello');
      done();
    };
    fixture.textContent = 'Hello';
  });

});
</script>

</body>
</html>
